function addCommas(e){e+="";for(var i=e.split("."),a=i[0],t=i.length>1?"."+i[1]:"",o=/(\d+)(\d{3})/;o.test(a);)a=a.replace(o,"$1,$2");return a+t}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,i){return 0==i?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","dojo/domReady!"],function(e,i,a){allLayers=[]});var map,maxLegendHeight,maxLegendDivHeight;require(["esri/map","esri/SnappingManager","esri/dijit/HomeButton","esri/dijit/Measurement","application/bootstrapmap","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/symbols/PictureMarkerSymbol","esri/geometry/webMercatorUtils","esri/config","dojo/keys","dojo/has","dojo/dom","dojo/on","dojo/domReady!"],function(e,i,a,t,o,n,r,s,l,c,d,p,m,g,u,h,y){function v(){1===h.byId("chkExtent").checked?I.activeGeocoder.searchExtent=map.extent:I.activeGeocoder.searchExtent=null}function f(){v();var e=I.find();e.then(function(e){b(e)}),$("#geosearchModal").modal("hide")}function L(e){M();var i=e.graphic?e.graphic:e.result.feature;i.setSymbol(E),S(e.result,i.symbol)}function b(e){if(e=e.results,e.length>0){M();for(var i=E,a=0;a<e.length;a++)S(e[a],i);w(e)}}function x(e){var i=e.indexOf(",");return i>0&&(e=e.substring(0,i)),e}function S(e,i){var a,t,o,n,r={};o=e.feature.geometry,r.address=e.name,r.score=e.feature.attributes.Score,a={address:x(r.address),score:r.score,lat:o.getLatitude().toFixed(2),lon:o.getLongitude().toFixed(2)},t=new s({title:"{address}",description:"Latitude: {lat}<br/>Longitude: {lon}"}),n=new l(o,i,a,t),map.graphics.add(n)}function w(e){for(var i=new c(map.spatialReference),a=0;a<e.length;a++)i.addPoint(e[a].feature.geometry);map.setExtent(i.getExtent().expand(2))}function M(){map.infoWindow.hide(),map.graphics.clear()}function k(e,i,a,t,o){return new d({angle:0,xoffset:i,yoffset:a,type:"esriPMS",url:e,contentType:"image/png",width:t,height:o})}map=e("mapDiv",{basemap:"gray",center:[-82.745,41.699],zoom:10});var C=new a({map:map},"homeButton");C.startup();var D=new t({map:map},h.byId("measurementDiv"));D.startup(),esri.config.defaults.io.corsEnabledServers.push("http://52.0.108.106:6080/"),$(window).resize(function(){$("#legendCollapse").hasClass("in")?(maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("height",maxLegendHeight),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)):$("#legendElement").css("height","initial")}),y(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var i=p.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(i.y.toFixed(3)),$("#longitude").html(i.x.toFixed(3))}),y(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),y(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var i=p.webMercatorToGeographic(e.mapPoint);$("#latitude").html(i.y.toFixed(3)),$("#longitude").html(i.x.toFixed(3))}}),y(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=p.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var z=new n("http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");y(h.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(z)}),y(h.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(z)}),y(h.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(z)}),y(h.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(z)}),y(h.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(z)}),y(h.byId("btnNatlMap"),"click",function(){map.addLayer(z)});var I=new r({value:"",maxLocations:25,autoComplete:!0,arcgisGeocoder:!0,autoNavigate:!1,map:map},"geosearch");I.startup(),I.on("select",L),I.on("findResults",b),I.on("clear",M),y(I.inputNode,"keydown",function(e){13==e.keyCode&&v()});var E=k("images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),y(h.byId("btnGeosearch"),"click",f),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/SpatialReference","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","dojo/query","dojo/dom"],function(e,i,a,t,o,n,r,s,l,c,d,p){var m=[],h=[];const y="http://wlera.wimcloud.usgs.gov:6080/arcgis/rest/services/WLERA/",v=new l(y+"reference/MapServer",{id:"studyArea",visible:!0});v.setVisibleLayers([1]),h.push(v),m.push({layer:v,title:" "}),v.inLegendLayers=!0;const f=new c(y+"reference/MapServer/2",{id:"parcels",visible:!1,minScale:1e5,mode:c.MODE_ONDEMAND,outfields:["*"]});h.push(f),f.inLegendLayers=!1;const L=new l(y+"hydroCondition/MapServer",{id:"dikeBreaks",visible:!1,minScale:1e5});L.setVisibleLayers([0]),h.push(L),L.inLegendLayers=!1;const b=new l(y+"hydroCondition/MapServer",{id:"culverts",visible:!1,minScale:1e5});b.setVisibleLayers([1]),h.push(b),b.inLegendLayers=!1;const x=new l(y+"hydroCondition/MapServer",{id:"degFlowlines",visible:!1,minScale:1e5});x.setVisibleLayers([2]),h.push(x),x.inLegendLayers=!1;const S=new l(y+"hydroCondition/MapServer",{id:"dikes",visible:!1,minScale:1e5});S.setVisibleLayers([3]),h.push(S),S.inLegendLayers=!1;const w=new l(y+"hydroCondition/MapServer",{id:"dikedAreas",visible:!1});w.setVisibleLayers([4]),h.push(w),w.inLegendLayers=!1;const M=new l(y+"restorationModel/MapServer",{id:"waterMask",visible:!1});M.setVisibleLayers([1]),h.push(M),M.inLegendLayers=!1;const k=new l(y+"restorationModel/MapServer",{id:"hydroperiod",visible:!1});k.setVisibleLayers([2]),h.push(k),k.inLegendLayers=!1;const C=new l(y+"restorationModel/MapServer",{id:"wetsoils",visible:!1});C.setVisibleLayers([3]),h.push(C),C.inLegendLayers=!1;const D=new l(y+"restorationModel/MapServer",{id:"flowline",visible:!1});D.setVisibleLayers([4]),h.push(D),D.inLegendLayers=!1;const z=new l(y+"restorationModel/MapServer",{id:"conservedLands",visible:!1});z.setVisibleLayers([5]),h.push(z),z.inLegendLayers=!1;const I=new l(y+"restorationModel/MapServer",{id:"imperviousSurfaces",visible:!1});I.setVisibleLayers([6]),h.push(I),I.inLegendLayers=!1;const E=new l(y+"restorationModel/MapServer",{id:"landuse",visible:!1});E.setVisibleLayers([7]),h.push(E),E.inLegendLayers=!1;const G=new l(y+"restorationModel/MapServer",{id:"normalized",visible:!0});G.setVisibleLayers([8]),h.push(G),m.push({layer:G,title:" "}),G.inLegendLayers=!0,map.addLayers(h);var H=map.enableSnapping({snapKey:u("mac")?g.META:g.CTRL}),V=[{layer:f}];H.setLayerInfos(V);for(var B=0;B<map.layerIds.length;B++){var T=map.getLayer(map.layerIds[B]);T.visible&&($("#"+T.id).button("toggle"),$("#"+T.id).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"))}$("button.lyrTog").click(function(e){$(this).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$(this).button("toggle"),e.preventDefault(),e.stopPropagation();var i=map.getLayer($(this).attr("id"));i.visible?i.setVisibility(!1):(i.setVisibility(!0),0==i.inLegendLayers&&(m.push({layer:i,title:" "}),i.inLegendLayers=!0,j.refresh()))}),$("#hydroConditionGroup, #parametersGroup, #4scaleGroup").on("hide.bs.collapse",function(){var e=$(this)[0].id.replace("Group","");$("#"+e).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$("#"+e).find("i.chevron").toggleClass("fa-chevron-right fa-chevron-down");var i=$(this).attr("id")+"Buttons";$("#"+i).button("toggle")}),$("#hydroConditionGroup, #parametersGroup, #4scaleGroup").on("show.bs.collapse",function(){var e=$(this)[0].id.replace("Group","");$("#"+e).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$("#"+e).find("i.chevron").toggleClass("fa-chevron-right fa-chevron-down")}),$(".zoomto").hover(function(e){$(".zoomDialog").remove();var i=this.parentNode.id,a=$('<div class="zoomDialog"><label class="zoomClose pull-right">X</label><br><div class="list-group"><a href="#" id="zoomscale" class="list-group-item zoomscale">Zoom to scale</a> <a id="zoomcenter" href="#" class="list-group-item zoomcenter">Zoom to center</a><a id="zoomextent" href="#" class="list-group-item zoomcenter">Zoom to extent</a></div></div>');$("body").append(a),$(".zoomDialog").css("left",event.clientX-80),$(".zoomDialog").css("top",event.clientY-5),$(".zoomDialog").mouseleave(function(){$(".zoomDialog").remove()}),$(".zoomClose").click(function(){$(".zoomDialog").remove()}),$("#zoomscale").click(function(e){var a=map.getLayer(i).minScale;map.setScale(a)}),$("#zoomcenter").click(function(e){var i=new n(-83.208084,41.628103,new r({wkid:4326}));map.centerAt(i)}),$("#zoomextent").click(function(e){var a=map.getLayer(i).fullExtent;map.setExtent(a)})}),$(".opacity").hover(function(){$(".opacitySlider").remove();var e=this.parentNode.id,i=map.getLayer(e).opacity,a=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+i+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(a),$("#slider")[0].value=100*i,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-5),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(i){var a=$("#slider")[0].value/100;console.log("o: "+a),$("#opacityValue").html("Opacity: "+a),map.getLayer(e).setOpacity(a)})});var j=new e({map:map,layerInfos:m},"legendDiv");j.startup()})});