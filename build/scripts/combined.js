function addCommas(e){e+="";for(var i=e.split("."),t=i[0],a=i.length>1?"."+i[1]:"",s=/(\d+)(\d{3})/;s.test(t);)t=t.replace(s,"$1,$2");return t+a}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,i){return 0==i?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","dojo/domReady!"],function(e,i,t){allLayers=[]});var map,maxLegendHeight,maxLegendDivHeight;require(["esri/map","esri/SnappingManager","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/dijit/Measurement","application/bootstrapmap","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/symbols/PictureMarkerSymbol","esri/geometry/webMercatorUtils","esri/config","dojo/keys","dojo/has","dojo/dom","dojo/on","dojo/domReady!"],function(e,i,t,a,s,o,n,r,l,c,d,p,m,g,u,h,y,v){function f(){1===y.byId("chkExtent").checked?E.activeGeocoder.searchExtent=map.extent:E.activeGeocoder.searchExtent=null}function b(){f();var e=E.find();e.then(function(e){x(e)}),$("#geosearchModal").modal("hide")}function L(e){k();var i=e.graphic?e.graphic:e.result.feature;i.setSymbol(T),S(e.result,i.symbol)}function x(e){if(e=e.results,e.length>0){k();for(var i=T,t=0;t<e.length;t++)S(e[t],i);M(e)}}function w(e){var i=e.indexOf(",");return i>0&&(e=e.substring(0,i)),e}function S(e,i){var t,a,s,o,n={};s=e.feature.geometry,n.address=e.name,n.score=e.feature.attributes.Score,t={address:w(n.address),score:n.score,lat:s.getLatitude().toFixed(2),lon:s.getLongitude().toFixed(2)},a=new l({title:"{address}",description:"Latitude: {lat}<br/>Longitude: {lon}"}),o=new c(s,i,t,a),map.graphics.add(o)}function M(e){for(var i=new d(map.spatialReference),t=0;t<e.length;t++)i.addPoint(e[t].feature.geometry);map.setExtent(i.getExtent().expand(2))}function k(){map.infoWindow.hide(),map.graphics.clear()}function C(e,i,t,a,s){return new p({angle:0,xoffset:i,yoffset:t,type:"esriPMS",url:e,contentType:"image/png",width:a,height:s})}map=e("mapDiv",{basemap:"gray",center:[-82.745,41.699],spatialReference:26917,zoom:10});const z=new t({map:map},"homeButton");z.startup();const D=new a({map:map},"locateButton");D.startup();var V=new s({map:map},y.byId("measurementDiv"));V.startup();var G=$('<tr class="esriMeasurementTableRow" id="utmCoords"><td><span>UTM17</span></td><td class="esriMeasurementTableCell"> <span id="utmX" dir="ltr">UTM X</span></td> <td class="esriMeasurementTableCell"> <span id="utmY" dir="ltr">UTM Y</span></td></tr>');$(".esriMeasurementResultTable").append(G),esri.config.defaults.io.corsEnabledServers.push("http://52.0.108.106:6080/"),$(window).resize(function(){$("#legendCollapse").hasClass("in")?(maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("height",maxLegendHeight),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)):$("#legendElement").css("height","initial")}),v(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var i=m.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(i.y.toFixed(4)),$("#longitude").html(i.x.toFixed(4))}),v(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),v(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var i=m.webMercatorToGeographic(e.mapPoint);$("#latitude").html(i.y.toFixed(4)),$("#longitude").html(i.x.toFixed(4))}}),v(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=m.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(4)),$("#longitude").html(e.x.toFixed(4))});var I=new n("http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer",{visible:!1});map.addLayer(I),v(y.byId("btnStreets"),"click",function(){map.setBasemap("streets"),I.setVisibility(!1)}),v(y.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),I.setVisibility(!1)}),v(y.byId("btnGray"),"click",function(){map.setBasemap("gray"),I.setVisibility(!1)}),v(y.byId("btnOSM"),"click",function(){map.setBasemap("osm"),I.setVisibility(!1)}),v(y.byId("btnTopo"),"click",function(){map.setBasemap("topo"),I.setVisibility(!1)}),v(y.byId("btnNatlMap"),"click",function(){I.setVisibility(!0)});var E=new r({value:"",maxLocations:25,autoComplete:!0,arcgisGeocoder:!0,autoNavigate:!1,map:map},"geosearch");E.startup(),E.on("select",L),E.on("findResults",x),E.on("clear",k),v(E.inputNode,"keydown",function(e){13==e.keyCode&&f()});var T=C("images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),v(y.byId("btnGeosearch"),"click",b),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/GeometryService","esri/tasks/ProjectParameters","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/SpatialReference","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","dojo/query","dojo/dom"],function(e,i,t,a,s,o,n,r,l,c,d,p,m,g){var y=[],v=[];const f="http://wlera.wimcloud.usgs.gov:6080/arcgis/rest/services/WLERA/",b=new a("http://wlera.wimcloud.usgs.gov:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer"),L=new d(f+"restorationModel/MapServer",{id:"normalized",visible:!0});L.setVisibleLayers([0]),v.push(L),y.push({layer:L,title:" "}),L.inLegendLayers=!0;const x=new d(f+"hydroCondition/MapServer",{id:"dikedAreas",visible:!1});x.setVisibleLayers([4]),v.push(x),x.inLegendLayers=!1;const w=new d(f+"reference/MapServer",{id:"studyArea",visible:!0});w.setVisibleLayers([0]),v.push(w),y.push({layer:w,title:" "}),w.inLegendLayers=!0;const S=new p(f+"reference/MapServer/1",{id:"parcels",visible:!1,minScale:1e5,mode:p.MODE_ONDEMAND,outfields:["*"]});v.push(S),S.inLegendLayers=!1;const M=new d(f+"hydroCondition/MapServer",{id:"dikeBreaks",visible:!1,minScale:1e5});M.setVisibleLayers([0]),v.push(M),M.inLegendLayers=!1;const k=new d(f+"hydroCondition/MapServer",{id:"culverts",visible:!1,minScale:1e5});k.setVisibleLayers([1]),v.push(k),k.inLegendLayers=!1;const C=new d(f+"hydroCondition/MapServer",{id:"degFlowlines",visible:!1,minScale:1e5});C.setVisibleLayers([2]),v.push(C),C.inLegendLayers=!1;const z=new d(f+"hydroCondition/MapServer",{id:"dikes",visible:!1,minScale:1e5});z.setVisibleLayers([3]),v.push(z),z.inLegendLayers=!1;const D=new d(f+"restorationModel/MapServer",{id:"waterMask",visible:!1});D.setVisibleLayers([2]),v.push(D),D.inLegendLayers=!1;const G=new d(f+"restorationModel/MapServer",{id:"hydroperiod",visible:!1});G.setVisibleLayers([3]),v.push(G),G.inLegendLayers=!1;const I=new d(f+"restorationModel/MapServer",{id:"wetsoils",visible:!1});I.setVisibleLayers([4]),v.push(I),I.inLegendLayers=!1;const E=new d(f+"restorationModel/MapServer",{id:"flowline",visible:!1});E.setVisibleLayers([5]),v.push(E),E.inLegendLayers=!1;const T=new d(f+"restorationModel/MapServer",{id:"conservedLands",visible:!1});T.setVisibleLayers([6]),v.push(T),T.inLegendLayers=!1;const H=new d(f+"restorationModel/MapServer",{id:"imperviousSurfaces",visible:!1});H.setVisibleLayers([7]),v.push(H),H.inLegendLayers=!1;const j=new d(f+"restorationModel/MapServer",{id:"landuse",visible:!1});j.setVisibleLayers([8]),v.push(j),j.inLegendLayers=!1,map.addLayers(v);var B=map.enableSnapping({snapKey:h("mac")?u.META:u.CTRL}),F=[{layer:S}];B.setLayerInfos(F);var q=new l(26917);V.on("measure-end",function(e){var i,t=e.geometry,a=-1*e.geometry.x;84>a&&a>78?b.project([t],q,function(e){i=e[0],console.log(i);var t=i.x.toFixed(0),a=i.y.toFixed(0);$("#utmX").html(t),$("#utmY").html(a)}):($("#utmX").html('<span class="label label-danger">outside zone</span>'),$("#utmY").html('<span class="label label-danger">outside zone</span>'))});for(var P=0;P<map.layerIds.length;P++){var R=map.getLayer(map.layerIds[P]);R.visible&&($("#"+R.id).button("toggle"),$("#"+R.id).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"))}$("button.lyrTog").click(function(e){$(this).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$(this).button("toggle"),e.preventDefault(),e.stopPropagation();var i=map.getLayer($(this).attr("id"));i.visible?i.setVisibility(!1):(i.setVisibility(!0),0==i.inLegendLayers&&(y.push({layer:i,title:" "}),i.inLegendLayers=!0,A.refresh()))}),$("#hydroConditionGroup, #parametersGroup, #4scaleGroup").on("hide.bs.collapse",function(){var e=$(this)[0].id.replace("Group","");$("#"+e).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$("#"+e).find("i.chevron").toggleClass("fa-chevron-right fa-chevron-down");var i=$(this).attr("id")+"Buttons";$("#"+i).button("toggle")}),$("#hydroConditionGroup, #parametersGroup, #4scaleGroup").on("show.bs.collapse",function(){var e=$(this)[0].id.replace("Group","");$("#"+e).find("i.checkBoxIcon").toggleClass("fa-check-square-o fa-square-o"),$("#"+e).find("i.chevron").toggleClass("fa-chevron-right fa-chevron-down")}),$(".zoomto").hover(function(e){$(".zoomDialog").remove();var i=this.parentNode.id,t=$('<div class="zoomDialog"><label class="zoomClose pull-right">X</label><br><div class="list-group"><a href="#" id="zoomscale" class="list-group-item zoomscale">Zoom to scale</a> <a id="zoomcenter" href="#" class="list-group-item zoomcenter">Zoom to center</a><a id="zoomextent" href="#" class="list-group-item zoomcenter">Zoom to extent</a></div></div>');$("body").append(t),$(".zoomDialog").css("left",event.clientX-80),$(".zoomDialog").css("top",event.clientY-5),$(".zoomDialog").mouseleave(function(){$(".zoomDialog").remove()}),$(".zoomClose").click(function(){$(".zoomDialog").remove()}),$("#zoomscale").click(function(e){var t=map.getLayer(i).minScale;map.setScale(t)}),$("#zoomcenter").click(function(e){var i=new r(-83.208084,41.628103,new l({wkid:4326}));map.centerAt(i)}),$("#zoomextent").click(function(e){var t=map.getLayer(i).fullExtent;map.setExtent(t)})}),$(".opacity").hover(function(){$(".opacitySlider").remove();var e=this.parentNode.id,i=map.getLayer(e).opacity,t=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+i+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(t),$("#slider")[0].value=100*i,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-5),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(i){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(e).setOpacity(t)})});var A=new e({map:map,layerInfos:y},"legendDiv");A.startup()})});